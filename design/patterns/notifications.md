# Notifications
通知系统可以让用户从你的应用中及时得到通知，例如朋友发来一条聊天信息或者一个日历提醒。可以把通知当成一个消息通道，用来提醒用户
重要的事件发生了，或者记录下用户没注意到的事件发生的历史，并且可以在所有 Android 设备上同步。

### New in Android 5.0
在 Android 5.0 中，通知系统在结构，视觉以及功能上有了重要更新：
* 通知与新的 material design 主题在视觉上保持一致
* 通知现在在设备锁屏时也可以出现，但是敏感信息仍然可以被隐藏
* 高优先级的通知现在使用一个新的格式，heads-up 通知
* 云同步通知：在一个设备上让通知消失，可以同时让它在多个设备上消失

Note: 在这一版本的 Android 系统中，通知与之前的版本有很大不同。之前版本的通知设计，可以参考 [Notifications in Android 4.4 and lower]()

## Anatomy of a Notification
这一节浏览通知的基本组成部分，以及他们是如何在不同类型的设备上出现的。

### Base layout
所有的通知都至少有下面的布局，包括：

* 通知图标。这个图标是原有应用的符号。如果应用会产生多种不同类型的通知，它也可能表示通知的类型。
* 通知标题和额外的信息
* 时间戳

通知使用在之前版本中 [Notification.Builder]() 创建，在 Android 5.0 中，也以相同的方式工作，只量有一些风格上的改变，不过系统已经
帮助你处理好了。想了解更多关于之前版本的通知，可以查看 [Notifications in Android 4.4 and lower]()

### Expanded layouts
对你的应用的通知来说，你可以选择提供信息的详细程度。他们可以显示消息的前几行或者显示一个大图的预览。额外信息部分可以向用户提供
更多的信息，在某种情况下，可以让用户阅读到整个消息。用户可以通过放大或者执行一个单手指的滑动在压缩和扩展版本之间切换。对单个
事件通知，Android 提供了三种扩展布局模板（文字，收件箱, 图片)供你在应用中使用。下面的图片显示了一个单事件的消息在手持设备上和
可穿戴设备上如何显示。

### Actions
Android 在通知的底部提供了可选的动作。在这些动作上，用户可以不必打开相应应用就能对消息执行常见的任务。这加快了交互过程，并且与
滑动消失配合，帮助用户聚焦于与他们相关的通知。

谨慎决定通知内的动作数目。动作越多，你创造的感知上的复杂度就越高。尽力保持动作数目最少，只包含最重要的和最有意义的动作。

通知内一般设置有下面这些特性的动作比较好：
* 对你显示的内容类型来说，是最本质，最经常使用，最典型的动作
* 让用户快速完成任务

避免下面这些动作：
* 模棱两可
* 与通知的默认动作一样（例如阅读或者打开）

你可以将最大动作数目设置为3， 每个都包含动作图标和名字。将动作添加到通知中，会使得通知展开，即使通知没有展开布局。由于动作只为
展开的通知显示，否则就隐藏，保证用户对通知执行的任何一个动作在应用内也都可以执行。

## Heads-up Notification
当一个重要消息到来时，可以在一个很短的时间内，向用户显示通知的展开状态，并显示可能执行的动作。

显示之后，通知退回通知中心。如果通知的优先级被设定为 High, Max, 或者 full-screen，那么他会使用 heads-up 通知。

heads-up 通知的好例子包括：
* 使用设备时的一个来电
* 使用设备时的警告
* 新的短信
* 低电量

## Guidelines
### Make it personal
对于其它人发来的通知（例如消息或者状态更新），使用 [setLargeIcon()]()来包含个人头像。也可以将与这个人相关的信息附加到通知的元
数据中（见 [EXTRA_PEOPLE]())

你的通知的主图标仍然会显示，用户会将它与状态栏显示的图标联系起来。

### Navigate to the right place
当用户触摸通知的主体时（动作按钮之外），打开你的应用，并且定位到与通知消息相关的视图中。多数情况下，这会是单个数据项的详情视图，例如消息，但是如果通知有多个，它也可能是一个概览视图。如果你的应用将用户带入顶层视图的下层，那么需要在栈中插入导航，以便用户
可以点击系统返回按钮，回到顶层视图。更多信息，可以查看 [Navigation]() 设计模式中的 Navigation into Your App via Home Screen 
Widgets and Notifications.

### Correctly set and manage notification priority
Android 支持通知的优先级标志。这个标志可以影响通知的出现，与其它通知的关系，并且帮助确保用户可以在第一时间看到最重要的通知。你
可以选择下面的优先级：

| Priority | Use |
| :-------:| :--:|
| MAX | 用于关键和紧急的通知，在时间紧迫的条件下，或者只有解决后才能继续执行一个特定任务时使用 |
| HIGH | 主要用于重要的沟通，例如消息或者聊天事件中，对用户而言有一些有趣的内容。高优先级消息会显示 heads-up 通知 |
| DEFAULT | 用户其它通知类型之外的所有情况 |
| LOW | 用户你想让用户知道，但是又不太着急的情况。低优先级通知倾向于在列表底部显示，这对于那些公开以及非直接的社交更新来说是个好机会：用户被通知，但是通知又绝不会比紧迫，直接的交流更优先 |
| MIN | 用户与场景相关的或者背景相关的信息，例如天气信息或者场景位置信息。最小优先级的通知并不出现在状态栏上。使用打开通知中心才能看到他们 |

### How to choose an appropriate priority
DEFAULT, HIGH 和 MAX 是打断式的优先级，有在主活动中打断用户的风险。为了避免打断用户，将打断式优先级用于下面的情况：
* 涉及其它人
* 时间敏感
* 可能会立即改变用户在真实世界的行为

设置成 LOW 和 MIN 的通知对用户仍然是有价值的：许多通知并不需要立刻获取用户的注意，或者振动用户的手腕，但是会在用户查看通知中心
时对用户有用。使用 LOW 和 MIN 优先级的标准是：

* 不涉及其它人
* 不是时间敏感的
* 包含用户感兴趣的信息，但是可以在闲暇时处理

### Set a notification category
如果你的通知属于下面的某一类，那么赋予它此类型。系统 UI，例如通知中心可能使用这一信息进行排序或者过滤。

| 类型 | 解释 |
|:---: | :---:|
| CATEGORY_CALL | 来电（视频或者声音），或者相似的同步通讯请求 |
| CATEGORY_MESSAGE | 发来的消息(短信，即时通讯) |
| CATEGORY_EMAIL | 异步消息（邮件) |
| CATEGORY_EVENT | 日历事件 |
| CATEGORY_PROMO | 推广或者广告 |
| CATEGORY_ALARM | 提醒或者计时器 |
| CATEGORY_PROGRESS | 长时间运行的后台操作的进度 |
| CATEGORY_SOCIAL | 社会化网络或者分享更新 |
| CATEGORY_ERROR | 后台操作或者认证状态错误 |
| CATEGORY_TRANSPORT | 对播放的媒体传输控制 |
| CATEGORY_SYSTEM | 系统或者设备状态更新，保留给系统使用 |
| CATEGORY_SERVICE | 运行后台服务的标志 |
| CATEGORY_RECOMMENDATION | 对一个特定事情的特别的，及时的推荐。例如，新应用可能会推荐一个用户下一步想要阅读的新故事 |
| CATEGORY_STATUS | 设备或者环境状态的即时信息 |

### Summarize your notifications
如果你的应用想要发送一个通知时，一个同种类型的通知正在进行，那么可以把他们合并成一条通知。而不要创建一条新通知。

一个概括性的通知有一份总结信息，并且告诉用户正在等待的通知的数目。

你可以使用扩展布局提供关于组成总结通知的单个通知的详细信息。这可以让用户知道什么通知正在等待以及他们是否对此有足够的兴趣。

### Make notifications optional
用户应该总是可以对通知进行控件。让用户可以禁止你的应用的通知，或者改变提醒的属性，例如提醒的声音，以及是否使用振动。可以在设置中添加一个通知设置。

### Use distinct icons
看一眼通知区域，用户就可以知道当前等待的通知是什么类型的。

* Do: 看看 Android 应用已经提供的通知图标，并且为你的应用创建和他们有明显区别的通知图标。
* Do: 对小图标使用合适的 [通知图标风格]()，对动作栏的图标使用 Material Light 风格的 [动作栏图标风格]()
* Do: 保持你的图标在视觉上的简洁，避免难以分辨的过于详细的信息
* Don't: 在小图标和动作栏图标中包含多余的阴影，他们有反锯齿的边缘，由于Android 使用图标作为 mask，这些图标应该被绘制成完全不透明的。
* Don't: 使用颜色把你的应用和其它应用区分开。通知图标只应该是白色背景的图片。

### Pulse the notification LED appropriately
许多 Android 设备包含一个通知 LED，当屏幕关闭时，用于告诉用户有通知消息。有 MAX, HIGH, DEFAULT 优先级的通知会导致 LED 变亮，
低优先级（例如  LOW 和 MIN) 是没有的。

用户对通知的控制应该包含 LED。当你使用 DEFUALT_LIGHTS, 时， LED 会变白。你的通知不应该使用一个不同的颜色，除非用户显式定制了它。

## Building Notifications That Users Care About
为了创建一个用户喜爱的应用，仔细设置通知是非常重要的。通知使你的应用具体化，并且对你的应用的个性化有帮助。不重要的通知会打扰
用户，并且会让他们感到气愤，所以，要谨慎使用通知。

### When to display a notification
为了创建用户喜欢用的应用，明白用户的注意力和焦点是需要保护的资源是非常重要的。虽然 Android 的通知系统已经被设计成最小化对用户
注意力的影响，意识到通知会打断用户的工作流仍然是非常重要的。在你为自己的通知系统作计划时，问问你自己，它是否重要到需要打断用户。如果你不确定，就要允许用户去设置通知，或者把通知的优先级设置成 LOW 或者 MIN，避免用户在做其它事情时被打断。

虽然行为良好的应用通常只在需要的时候才打断用户，但是在很少的情况下，主动打断用户的通知会成为应用的一个优点。

将通知主要用于时间敏感的任务，特别是涉及其它用户的同步事件。例如，一条发送过来的聊天消息是实时的，并且是同步形式的交流：另一个用户正在等待你的回复 。日历事件是什么时候使用通知去获取用户注意力的另一个好例子，因为事件是即将发生的，并且日历事件通常涉及
其它人。

### When not to display a notification
在许多情况下，通知是不合适的：
* 避免把那些不是直接给用户的消息或者不是时间第三的消息通知给用户。例如，社交网络中那些异步的，非直接的更新，通常是不值得实时打断用户。对那些不在乎这些信息的用户，要给他们选择是否打开这类通知的机会。
* 如果相关的新消息已经在屏幕上了，就不要再创建一个通知。使用应用中的 UI 本身来通知用户新消息。例如聊天应用中，用户正在聊天时就不用再发起一个通知了。
* 如果系统可以在用户不参与的条件下，解决问题，就不要用那些底层的技术性的操作来打断用户，例如保存或者同步信息，或者应用的更新信息。
* 不要用那些没有通知内容，而仅仅是用来给你的应用打广告的通知。通知需要提供有用的，及时的新信息，并且不应该仅仅用于启动你的应用。
* 不要仅仅为了让你的名片多出现在用户面前，就创建过多的通知。这样的行为可能会疏远你的用户。最好的方式是提供一个小的更新信息，让他们参与到你的应用中的方式可以是创建一个控件，并且可以把他们放在主屏幕上。

## Interacting with Notificatiosn
通知是通过状态栏的图标来标识的，可以通过打开通知抽屉来访问。

点击一条通知可能打开相应应用，查看与通知对应的详情。向左或者向右滑动可以将其从抽屉中删除。

### Ongoing notifications
正在进行的通知可以通知用户后台运行的程序正在运行。例如，音乐播放器可以在通知系统中显示正在播放的音乐进度，直到用户停止播放。正在进行的通知可以向用户显示长时间运行的任务，例如文件下载或者视频编码。用户不能从通知抽屉中手动移除正在进行的通知。

### Media playback
在 Android 5.0 中，锁屏状态上，并不显示对已经废弃的 [RemoteControlClient]() 类的传输控制。但是它是显示通知的，所以每个应用的
播放通知现在成为用户在锁屏状态下控制播放的主要方式。这一行为给了应用更多的控制，包括显示哪个按钮，以什么方式，使得无论是否在锁屏状态下，都能为用户提供一致的体验。

### Dialogs and toasts
如果你的应用没有在当前的屏幕上，不应该创建对话框或者 toasts。对话框或者 toast 只应该在应用内部作为对用户的即时的响应。更多属于对话框以及 toast 使用的指导，可以参考 [Confriming & Acknowledging]()

### Ranking and ordering
通知是新消息，所以在优先级的基础上，按逆时间序显示。

通知是锁屏的一个关键部分，并且是每次屏幕显示时的一个显著特色。锁屏上的空间是很紧张的，所以识别出紧迫或者重要的通知比平时更重要。出于这个原因，Android 对通知而言有一个复杂的排序算法，算法受下列因素影响：

* 时间戳和应用声明的优先级
* 通知最近是否使用声音或者振动打扰过用户（如果手机刚刚发出了噪音，用户想要知道什么发生了，那么锁屏会响应用户)
* 那些使用 [EXTRA_PEOPLE]()附加到通知的人，特别是他们是否是被加星的联系人

为了更好的利用这一排序，关注你想要创建的用户体验，而不是想要在列表中创建一个特别的点。

### On the lock screen
由于通知在锁屏状态下是可见的，所以用户隐私需要着重考虑。通知通常包含敏感信息，不应该对任何拿起设备的人都可见。

* 对包含安全锁屏的设备(PIN, pattern 或者密码)，那么接口包含公共和私有部分。公共接口可以在安全锁屏上显示，因此可以被任何人看到。隐私接口是锁屏背后的世界，只对登陆到设备的人显示。

### User control over information displayed on the secure lock screen
当设备安全锁屏时，用户可以选择隐藏敏感信息。在这种情况 下，系统 UI 会考虑通知的可见等级，并计算出什么是可以被安全显示的。

要控制可见等级，可以调用  [Notification.Builder.setVisibility()]()，并且指定下面的值：
* [VISIBILITY_PUBLIC](). 显示通知的全部内容，如果没有指定可见性的话，这是系统默认的显示方式
* [VISIBILITY_PRIVATE](). 在锁屏时，显示通知的基本信息，包含图标以及应用的名称。通知的细节并不会被显示。需要记得下面这些好主意：
  - 如果你想要系统为你的消息显示一个不同的公共版本，可以在 [Notification.publicVersion]() 域中设置一个可替代的消息对象
  - 这一设置可以让你的应用有机会创建一个修定版本的内容，他们有用但是又不会泄露个人信息，考虑短信应用，它的通知包含短信内容以及发送人名称和联系人图标。这个通知应该被设置成 VISIBILITY_PRIVATE，但是 publicVersion 仍然可以包含一些有用的信息，例如 “3条新消息”，而不包含其它详细信息
* NOTIFICATION.VISIBILITY_SEcRET. 只显示最少的信息，甚至不包含通知图标

## Notifications on Android Wear
通知和他们的动作在可穿戴设备上默认是连接在一起的。开发者可以控制哪个通知可以从手机推送到手表上，反之亦然。开发者也可以控制哪个动作进行推送。如果你的应用包含那些不能在一次点击中完成的动作，要么在你的手表通知中隐藏这些动作，要么考虑在手表应用中把他们挂起，让用户可以在手表中完成这一动作。

### Bridging notifications and actions
一个已经连接的设备，例如手机，可以把通知推送给手表设备，这样通知就可以在那里显示了。类似的，它也可以推送动作，这样用户就可以在手表上执行这些动作。

#### Bridge
* 即时消息
* 单击动作，例如 +1, 喜欢，加心

#### Don't bridge
* 新到达的 postcats 通知
* 不可能在手机上执行的动作

### Unique actions to define for Wear
有一些动作，你只能在手表上执行，他们包含
* 快速的对列表响应，例如 “马上返回”
* 打开手机
* 评论或者回复动作，用于打开对讲输入屏幕
* 启动手表相关的应用
